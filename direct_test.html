<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ç›´æ¥æµ‹è¯• - Portfolio</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .header { margin-bottom: 20px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { padding: 10px 20px; cursor: pointer; border-radius: 4px; border: 1px solid #ddd; }
        .tab.active { background: #007bff; color: white; border-color: #007bff; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background: #f5f5f5; font-weight: bold; }
        .info { background: #e3f2fd; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Portfolio ç›´æ¥æµ‹è¯•</h1>
            <div class="info">
                <p><strong>å½“å‰åˆ†ç±»:</strong> <span id="currentCategory">all</span></p>
                <p><strong>API URL:</strong> <code id="apiUrl">/api/portfolio</code></p>
                <p><strong>æ•°æ®æ•°é‡:</strong> <span id="dataCount">0</span></p>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchCategory('all')" id="tab-all">å…¨éƒ¨</div>
            <div class="tab" onclick="switchCategory('stock_cn')" id="tab-stock_cn">Aè‚¡</div>
            <div class="tab" onclick="switchCategory('stock_hk')" id="tab-stock_hk">æ¸¯è‚¡</div>
            <div class="tab" onclick="switchCategory('stock_us')" id="tab-stock_us">ç¾è‚¡</div>
            <div class="tab" onclick="switchCategory('fund')" id="tab-fund">åŸºé‡‘</div>
        </div>

        <div class="info">
            <h3>è°ƒè¯•æ—¥å¿—</h3>
            <pre id="debugLog">ç­‰å¾…æ“ä½œ...</pre>
        </div>

        <table>
            <thead>
                <tr>
                    <th>ä»£ç </th>
                    <th>åç§°</th>
                    <th>æ•°é‡</th>
                    <th>ä»·æ ¼</th>
                    <th>è´§å¸</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr><td colspan="5" style="text-align: center;">ç‚¹å‡»åˆ†ç±»æŒ‰é’®åŠ è½½æ•°æ®</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        let currentCategory = 'all';

        function log(message) {
            const logEl = document.getElementById('debugLog');
            logEl.innerHTML = message + '\n' + logEl.innerHTML;
        }

        async function switchCategory(type) {
            log('=== åˆ‡æ¢åˆ†ç±» ===');
            log('ä»: ' + currentCategory);
            log('åˆ°: ' + type);
            
            currentCategory = type;
            document.getElementById('currentCategory').innerText = currentCategory;
            
            // æ›´æ–°æ ‡ç­¾æ ·å¼
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById('tab-' + type).classList.add('active');
            
            // æ„å»ºAPI URL
            const apiUrl = currentCategory === 'all' ? '/api/portfolio' : `/api/portfolio?type=${currentCategory}`;
            document.getElementById('apiUrl').innerText = apiUrl;
            
            log('è¯·æ±‚: ' + apiUrl);
            
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                log('æˆåŠŸï¼è¿”å› ' + data.length + ' æ¡æ•°æ®');
                document.getElementById('dataCount').innerText = data.length;
                
                log('æ•°æ®: ' + data.map(d => d.code).join(', '));
                
                // æ›´æ–°è¡¨æ ¼
                const tbody = document.getElementById('tableBody');
                tbody.innerHTML = data.map(item => `
                    <tr>
                        <td><strong>${item.code}</strong></td>
                        <td>${item.name}</td>
                        <td>${item.qty}</td>
                        <td>${item.price}</td>
                        <td>${item.curr}</td>
                    </tr>
                `).join('');
            } catch (error) {
                log('é”™è¯¯: ' + error);
            }
        }

        window.onload = function() {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            switchCategory('all');
        };
    </script>
</body>
</html>