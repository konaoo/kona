# 版本更新记录

## v11.2.0 (2026-01-16) - 正在开发中
- **新功能：市场快讯 (Market Live)**
  - 基于金十数据 (Jin10) 的 7x24 小时实时快讯
  - 后端自动抓取与解析
  - 前端实时轮询更新
  - 独立于现有资产功能，便于维护

## v11.1.1 (2026-01-15)
- **前端架构重构**：
  - **引入基础模板系统**（base.html）：统一侧边栏、导航、模态框等通用组件
  - **模板分离**：将投资页面从 index.html 迁移到独立的 investment.html
  - **新增资产分析页面**（analysis.html）：提供专门的资产分析视图
  - **资产页面重构**（assets.html）：基于新模板系统重构，提升代码可维护性
- **后端优化**：
  - 新增路由处理器支持分离的页面（/analysis、/investment）
  - 优化数据库操作，提升性能和错误处理
  - 改进快照功能的错误处理机制
- **UI/UX 改进**：
  - 统一所有页面的侧边栏导航和样式
  - 统一模态框、按钮等组件的交互体验
  - 改进响应式设计，适配不同屏幕尺寸
  - 更好地集成隐私模式功能
- **代码质量提升**：
  - 移除重复的 CSS 和 JavaScript 代码
  - 改进代码组织结构，提高可维护性
  - 更好的关注点分离（前端展示 vs 业务逻辑）
- **文件变更**：
  - 新增：templates/base.html（基础模板）
  - 新增：templates/investment.html（投资页面）
  - 新增：templates/analysis.html（分析页面）
  - 重构：templates/assets.html（资产页面）
  - 优化：app.py（路由处理）
  - 优化：core/db.py（数据库操作）

## v11.1.0 (2026-01-14)
- **核心功能升级**：
  - **全局隐私模式**：点击右上角眼睛图标，一键隐藏所有金额（显示为 `****`），保留百分比和价格，支持刷新后状态保持。
  - **持仓修正功能**：支持在持仓明细中直接修改数量、成本价，并支持手动调整累计盈亏（Adjustment）。
  - **交互升级**：操作列改为下拉菜单（更多操作），整合加仓、减仓、修正、删除功能。
- **搜索与数据修复**：
  - 修复负债计算逻辑错误（正负号问题）。
  - 修复港股、美股、基金的搜索功能，优化代码显示格式（保留.HK后缀，美股大写等）。
  - 修复持仓明细中累计盈亏计算逻辑，使其正确包含调整值。
- **UI/UX 优化**：
  - 优化盈亏数据的字体和样式。
  - 资产名称过长时自动截断显示省略号。
  - 修复截图时数值被意外选中的问题。
  - 移除无用的刷新按钮。

## v11.0.1 (2026-01-13)
- UI优化：我的资产页面重新设计
  - 总资产看板沿用投资页面风格（左侧总资产，右侧分类卡片带边框）
  - 投资资产详情区：显示持有总市值、今日盈亏、持仓盈亏、累计盈亏
  - 分类持仓卡片：A股、美股、港股、基金各自显示市值和盈亏
  - 所有卡片统一使用2px边框样式

## v11.0.0 (2026-01-13)
- 新功能：新增"我的资产"页面
  - 总资产看板：显示现金资产+投资资产+其他资产的总和
  - 现金资产管理：支持添加、编辑、删除
  - 其他资产管理：支持添加、编辑、删除
  - 投资资产：自动获取持仓总市值
  - 独立的assets.html模板，与投资页面代码分离
- 侧边栏新增"我的资产"菜单入口
- 新增API：/api/cash_assets/update, /api/other_assets/update

## v10.9.13 (2026-01-13)
- UI优化：指数看板趋势图重新设计
  - 趋势图从header小图标改为卡片底部背景
  - 添加渐变填充效果，更加美观
  - 线条加粗(2px)，颜色根据涨跌变化(红涨绿跌)
  - 图表自适应卡片宽度

## v10.9.12 (2026-01-13)
- UI优化：指数看板添加边框，与盈亏面板风格统一
  - 为`.idx-card`添加`border: 2px solid var(--border)`

## v10.9.11 (2026-01-13)
- UI优化：盈亏数据面板添加边框
  - 为`.pnl-stat-item`添加`border: 2px solid var(--border)`
  - 增强视觉层次感

## v10.9.10 (2026-01-13)
- 修复：使用绝对URL避免浏览器相对URL拼接问题
  - 问题：相对URL`/api/portfolio`被浏览器拼接成完整URL时出错
  - 修复：使用绝对URL `http://127.0.0.1:5003/api/portfolio`
  - 添加separator变量处理`?`和`&`的正确使用

## v10.9.9 (2026-01-13)
- 修复：URL拼接逻辑错误导致all分类404错误
  - 问题：所有URL都用`&`拼接cache-breaking参数
  - 当URL是`/api/portfolio`时，应该用`?`而不是`&`
  - 修复：根据URL是否已有参数来选择正确的分隔符
  - 添加separator变量和详细日志

## v10.9.8 (2026-01-13)
- 修复：添加更详细的调试日志和更强的缓存控制
  - 前端：显示完整的fetch URL和cache-breaking参数
  - 前端：在switchCategory中添加更详细的日志
  - 后端：添加Vary头和更严格的Cache-Control（max-age=0, private）
  - 便于准确定位分类切换问题

## v10.9.7 (2026-01-13)
- 修复：回退到v10.9并添加简单的cache-breaking参数
  - 避免复杂的URL拼接逻辑导致的代码错误
  - 只在fetch调用添加随机参数（`${timestamp}_${random}`）
  - 保持代码简洁性

## v10.9.6 (2026-01-13)
- 修复：API URL拼接错误导致type参数被cache-breaking参数覆盖
  - cache-breaking参数（t=...）被拼接到type参数后面
  - 导致type参数变成`stock_us?t=...`，被识别为无效类型
  - 修复URL拼接逻辑：使用`?`或`&`根据URL是否已有参数

## v10.9.5 (2026-01-13)
- 修复：API响应缓存导致分类切换仍然无效
  - 在后端API添加更详细的日志调试
  - 前端使用更强的cache-breaking参数（时间戳+随机字符串）
  - 确保每次请求都能获取最新数据

## v10.9.3 (2026-01-13)
- 修复：switchCategory函数被截断
  - 之前的编辑操作导致switchCategory函数体丢失
  - 恢复了完整的switchCategory函数代码
  - 包括清空portfolioData、设置forceRenderFull、调用refreshAll等逻辑

## v10.9.2 (2026-01-13)
- 修复：JavaScript语法错误导致页面无法加载
  - script 标签未正确关闭
  - 导致整个JavaScript无法执行
  - 已修复script标签结构

## v10.9.1 (2026-01-13)
- 修复：浏览器缓存导致分类切换问题
  - 在 /api/portfolio 端点添加 Cache-Control 和 Pragma 头
  - 禁止浏览器缓存API响应
  - 确保每次切换分类都能获取最新数据

## v10.9 (2026-01-13)
- 修复：切换分类调试优化
  - 添加详细的console调试日志
  - 便于排查分类切换问题

## v10.8 (2026-01-13)
- 修复：切换分类功能重新优化
  - 添加 forceRenderFull 标志位，强制切换分类时重新渲染
  - 确保分类切换功能正常工作

## v10.7 (2026-01-13)
- 修复：切换分类时列表无反应问题
  - 切换分类时清空portfolioData，强制重新渲染表格
  - 确保分类切换功能正常工作

## v10.6 (2026-01-13)
- UI样式优化：看板边框调整
  - 移除指数卡片的粗描边效果，更简洁清爽
  - 移除盈亏统计卡片的粗描边效果
  - 增加盈亏卡片宽度（150px -> 180px），数据展示更舒展

## v10.5 (2026-01-13)
- 用户体验优化：实现无感知数据更新
  - 首次加载：完整渲染表格
  - 后续更新：智能差异更新，只更新变化的数值
  - 解决表格闪烁问题，提升数据更新流畅度
  - 只有资产增删时才重新渲染整个表格

## v10.4 (2026-01-13)
- 添加.gitignore文件，支持版本回退
- 优化代码：修复港股、美股、基金价格获取问题
  - 港股：修复代码格式转换（rt_hk -> hk）和数据索引问题
  - 基金：修复天天基金API URL配置
  - 美股：修复纯字母代码（SE、BILI）价格获取逻辑
- 性能优化：batch_get_prices 改用并发获取（10线程）
- 安全性优化：db.py 添加SQL字段白名单验证
- 代码质量优化：移除重复导入，修复re.search()潜在错误
