# 版本更新记录

## v10.9.10 (2026-01-13)
- 修复：使用绝对URL避免浏览器相对URL拼接问题
  - 问题：相对URL`/api/portfolio`被浏览器拼接成完整URL时出错
  - 修复：使用绝对URL `http://127.0.0.1:5003/api/portfolio`
  - 添加separator变量处理`?`和`&`的正确使用

## v10.9.9 (2026-01-13)
- 修复：URL拼接逻辑错误导致all分类404错误
  - 问题：所有URL都用`&`拼接cache-breaking参数
  - 当URL是`/api/portfolio`时，应该用`?`而不是`&`
  - 修复：根据URL是否已有参数来选择正确的分隔符
  - 添加separator变量和详细日志

## v10.9.8 (2026-01-13)
- 修复：添加更详细的调试日志和更强的缓存控制
  - 前端：显示完整的fetch URL和cache-breaking参数
  - 前端：在switchCategory中添加更详细的日志
  - 后端：添加Vary头和更严格的Cache-Control（max-age=0, private）
  - 便于准确定位分类切换问题

## v10.9.7 (2026-01-13)
- 修复：回退到v10.9并添加简单的cache-breaking参数
  - 避免复杂的URL拼接逻辑导致的代码错误
  - 只在fetch调用添加随机参数（`${timestamp}_${random}`）
  - 保持代码简洁性

## v10.9.6 (2026-01-13)
- 修复：API URL拼接错误导致type参数被cache-breaking参数覆盖
  - cache-breaking参数（t=...）被拼接到type参数后面
  - 导致type参数变成`stock_us?t=...`，被识别为无效类型
  - 修复URL拼接逻辑：使用`?`或`&`根据URL是否已有参数

## v10.9.5 (2026-01-13)
- 修复：API响应缓存导致分类切换仍然无效
  - 在后端API添加更详细的日志调试
  - 前端使用更强的cache-breaking参数（时间戳+随机字符串）
  - 确保每次请求都能获取最新数据

## v10.9.3 (2026-01-13)
- 修复：switchCategory函数被截断
  - 之前的编辑操作导致switchCategory函数体丢失
  - 恢复了完整的switchCategory函数代码
  - 包括清空portfolioData、设置forceRenderFull、调用refreshAll等逻辑

## v10.9.2 (2026-01-13)
- 修复：JavaScript语法错误导致页面无法加载
  - script 标签未正确关闭
  - 导致整个JavaScript无法执行
  - 已修复script标签结构

## v10.9.1 (2026-01-13)
- 修复：浏览器缓存导致分类切换问题
  - 在 /api/portfolio 端点添加 Cache-Control 和 Pragma 头
  - 禁止浏览器缓存API响应
  - 确保每次切换分类都能获取最新数据

## v10.9 (2026-01-13)
- 修复：切换分类调试优化
  - 添加详细的console调试日志
  - 便于排查分类切换问题

## v10.8 (2026-01-13)
- 修复：切换分类功能重新优化
  - 添加 forceRenderFull 标志位，强制切换分类时重新渲染
  - 确保分类切换功能正常工作

## v10.7 (2026-01-13)
- 修复：切换分类时列表无反应问题
  - 切换分类时清空portfolioData，强制重新渲染表格
  - 确保分类切换功能正常工作

## v10.6 (2026-01-13)
- UI样式优化：看板边框调整
  - 移除指数卡片的粗描边效果，更简洁清爽
  - 移除盈亏统计卡片的粗描边效果
  - 增加盈亏卡片宽度（150px -> 180px），数据展示更舒展

## v10.5 (2026-01-13)
- 用户体验优化：实现无感知数据更新
  - 首次加载：完整渲染表格
  - 后续更新：智能差异更新，只更新变化的数值
  - 解决表格闪烁问题，提升数据更新流畅度
  - 只有资产增删时才重新渲染整个表格

## v10.4 (2026-01-13)
- 添加.gitignore文件，支持版本回退
- 优化代码：修复港股、美股、基金价格获取问题
  - 港股：修复代码格式转换（rt_hk -> hk）和数据索引问题
  - 基金：修复天天基金API URL配置
  - 美股：修复纯字母代码（SE、BILI）价格获取逻辑
- 性能优化：batch_get_prices 改用并发获取（10线程）
- 安全性优化：db.py 添加SQL字段白名单验证
- 代码质量优化：移除重复导入，修复re.search()潜在错误

